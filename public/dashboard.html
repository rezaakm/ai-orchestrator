<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morpheus - AI Proposal Engine</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e4e4e7;
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Grok-style animated gradient background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            animation: drift 30s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes drift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(3deg); }
            66% { transform: translate(-20px, 20px) rotate(-3deg); }
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: rgba(17, 17, 27, 0.6);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 50px;
            border-radius: 24px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.03), rgba(59, 130, 246, 0.03));
            pointer-events: none;
        }
        
        h1 {
            color: #ffffff;
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -2px;
            position: relative;
        }
        
        .subtitle {
            color: #a1a1aa;
            font-size: 18px;
            font-weight: 400;
            position: relative;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .card {
            background: rgba(17, 17, 27, 0.6);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 32px;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .card:hover {
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.15);
        }
        
        .card h2 {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-healthy { 
            background: #10b981;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.5);
        }
        
        .status-error { 
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.5);
        }
        
        .status-warning { 
            background: #f59e0b;
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.5);
        }
        
        .service-list {
            list-style: none;
        }
        
        .service-item {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            color: #e4e4e7;
        }
        
        .service-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(139, 92, 246, 0.2);
        }
        .btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: #ffffff;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 24px rgba(139, 92, 246, 0.25);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.35);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 4px 24px rgba(59, 130, 246, 0.25);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.35);
        }
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #d4d4d8;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            background: rgba(39, 39, 42, 0.6);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 10px;
            color: #e4e4e7;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #9333ea;
            background: rgba(39, 39, 42, 0.8);
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
        }
        
        input::placeholder, textarea::placeholder {
            color: #71717a;
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        input[type="range"] {
            padding: 0;
            height: 6px;
            background: rgba(147, 51, 234, 0.2);
            border: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(147, 51, 234, 0.6);
        }
        
        .result-box {
            background: rgba(39, 39, 42, 0.4);
            border: 1px solid rgba(147, 51, 234, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .result-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .result-box::-webkit-scrollbar-track {
            background: rgba(39, 39, 42, 0.4);
            border-radius: 4px;
        }
        
        .result-box::-webkit-scrollbar-thumb {
            background: rgba(147, 51, 234, 0.5);
            border-radius: 4px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 3px solid rgba(147, 51, 234, 0.2);
            border-top: 3px solid #9333ea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success { 
            color: #10b981; 
            font-weight: 700;
            font-size: 16px;
        }
        
        .error { 
            color: #ef4444; 
            font-weight: 700;
            font-size: 16px;
        }
        
        .link {
            color: #9333ea;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .link:hover {
            color: #a855f7;
            text-decoration: underline;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.4);
            color: #10b981;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 13px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            font-family: 'Courier New', monospace;
        }
        
        pre::-webkit-scrollbar {
            height: 8px;
        }
        
        pre::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        
        pre::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.3);
            border-radius: 4px;
        }
        
        /* Glow effect for important elements */
        .card h2::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 50%;
            background: radial-gradient(ellipse at center, rgba(147, 51, 234, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }
        
        .card:hover h2::after {
            opacity: 1;
        }
        
        .tab-btn {
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            color: #d4d4d8;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 14px;
        }
        
        .tab-btn:hover {
            background: rgba(147, 51, 234, 0.2);
            border-color: rgba(147, 51, 234, 0.5);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            border-color: #9333ea;
            color: white;
            box-shadow: 0 4px 15px rgba(147, 51, 234, 0.4);
        }
        
        .grok-tab {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display:flex; align-items:center; gap:20px;">
                <img src="/images/morpheus-logo.png" alt="Morpheus Logo" style="height:60px; position:relative; z-index:1;" onerror="this.style.display='none'">
                <div>
                    <h1>‚ö° MORPHEUS</h1>
                    <p class="subtitle">AI-Powered Proposal Generation Engine</p>
                </div>
            </div>
        </div>

        <!-- Service Status -->
        <div class="grid">
            <div class="card">
                <h2><span id="health-indicator" class="status-indicator status-warning"></span> System Health</h2>
                <button class="btn" onclick="checkHealth()">Check Status</button>
                <div id="health-result" class="result-box" style="display:none;"></div>
            </div>

            <div class="card">
                <h2>üìä Active Services</h2>
                <ul class="service-list" id="services-list">
                    <li class="service-item">Loading...</li>
                </ul>
            </div>

            <div class="card">
                <h2>‚ö° Quick Actions</h2>
                <button class="btn" onclick="showSection('research')" style="width:100%; margin-bottom:10px;">Research</button>
                <button class="btn btn-secondary" onclick="showSection('proposal')" style="width:100%; margin-bottom:10px;">Generate Proposal</button>
                <button class="btn" onclick="showSection('gamma')" style="width:100%; margin-bottom:10px;">Create Presentation</button>
                <button class="btn" onclick="showSection('grok')" style="width:100%; margin-bottom:10px;">Chat with Grok</button>
                <button class="btn" onclick="showSection('image')" style="width:100%;">Generate Image</button>
            </div>
        </div>

        <!-- Research Section -->
        <div class="card" id="research-section" style="display:none;">
            <h2>üîç AI Research</h2>
            <div class="form-group">
                <label>Research Topic</label>
                <input type="text" id="research-topic" placeholder="e.g., Luxury automotive events in Dubai">
            </div>
            <div class="form-group">
                <label>Depth</label>
                <select id="research-depth">
                    <option value="basic">Basic</option>
                    <option value="detailed" selected>Detailed</option>
                    <option value="comprehensive">Comprehensive</option>
                </select>
            </div>
            <button class="btn" onclick="conductResearch()">Start Research</button>
            <div class="loading" id="research-loading">
                <div class="spinner"></div>
                <p>Researching with Perplexity + Claude...</p>
            </div>
            <div id="research-result"></div>
        </div>

        <!-- Proposal Generation Section -->
        <div class="card" id="proposal-section" style="display:none;">
            <h2>üìÑ Generate Complete Proposal</h2>
            <div class="form-group">
                <label>Client Name</label>
                <input type="text" id="proposal-client" placeholder="e.g., ICAUR">
            </div>
            <div class="form-group">
                <label>Event Type</label>
                <input type="text" id="proposal-event" placeholder="e.g., Luxury SUV Test Drive Experience">
            </div>
            <div class="form-group">
                <label>Event Details (JSON)</label>
                <textarea id="proposal-details" placeholder='{"location": "Dubai Marina", "attendees": 200}'></textarea>
            </div>
            <div class="form-group">
                <label>Number of Slides</label>
                <input type="number" id="proposal-slides" value="6" min="3" max="20">
            </div>
            <button class="btn btn-secondary" onclick="generateProposal()">Generate Proposal</button>
            <div class="loading" id="proposal-loading">
                <div class="spinner"></div>
                <p>Generating proposal (research + presentation)...</p>
            </div>
            <div id="proposal-result"></div>
        </div>

        <!-- Gamma Presentation Section -->
        <div class="card" id="gamma-section" style="display:none;">
            <h2>üé® Create Presentation</h2>
            <div class="form-group">
                <label>Presentation Content</label>
                <textarea id="gamma-content" placeholder="Enter your presentation content here..."></textarea>
            </div>
            <div class="form-group">
                <label>Number of Slides</label>
                <input type="number" id="gamma-slides" value="5" min="1" max="20">
            </div>
            <button class="btn" onclick="createPresentation()">Create with Gamma</button>
            <div class="loading" id="gamma-loading">
                <div class="spinner"></div>
                <p>Creating presentation...</p>
            </div>
            <div id="gamma-result"></div>
        </div>

        <!-- Grok Enhanced Section -->
        <div class="card" id="grok-section" style="display:none;">
            <h2>ü§ñ Grok AI by xAI - Full Capabilities</h2>
            
            <!-- Tab Navigation -->
            <div style="display:flex; gap:10px; margin-bottom:20px; border-bottom:2px solid rgba(147,51,234,0.2); padding-bottom:15px; flex-wrap:wrap;">
                <button class="tab-btn active" onclick="switchGrokTab(event, 'chat')">üí¨ Chat</button>
                <button class="tab-btn" onclick="switchGrokTab(event, 'social')">üåê Social Insights</button>
                <button class="tab-btn" onclick="switchGrokTab(event, 'analyze')">üìä Analyze</button>
                <button class="tab-btn" onclick="switchGrokTab(event, 'creative')">‚ú® Creative</button>
                <button class="tab-btn" onclick="switchGrokTab(event, 'code')">üíª Code</button>
            </div>

            <!-- Chat Tab -->
            <div id="grok-chat-tab" class="grok-tab">
                <p style="color:#a1a1aa; margin-bottom:20px;">Have a conversation with Grok.</p>
                
                <div class="form-group">
                    <label>Your Message</label>
                    <textarea id="grok-message" placeholder="Ask Grok anything..."></textarea>
                </div>
                
                <div style="display:grid; grid-template-columns:2fr 1fr; gap:15px;">
                    <div class="form-group">
                        <label>Model</label>
                        <select id="grok-model">
                            <option value="grok-4-latest" selected>Grok 4 Latest</option>
                            <option value="grok-3">Grok 3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Temperature: <span id="temp-value">0.7</span></label>
                        <input type="range" id="grok-temperature" min="0" max="2" step="0.1" value="0.7">
                    </div>
                </div>
                
                <button class="btn" onclick="chatWithGrok()">Send to Grok</button>
            </div>

            <!-- Social Insights Tab -->
            <div id="grok-social-tab" class="grok-tab" style="display:none;">
                <p style="color:#a1a1aa; margin-bottom:20px;">Get real-time insights from X/Twitter and social media trends.</p>
                
                <div class="form-group">
                    <label>Topic to Analyze</label>
                    <input type="text" id="social-topic" placeholder="e.g., luxury cars, Dubai events, BMW vs Mercedes">
                </div>
                
                <div class="form-group">
                    <label>Analysis Type</label>
                    <select id="social-type">
                        <option value="trending">What's Trending</option>
                        <option value="sentiment">Sentiment Analysis</option>
                        <option value="comparison">Compare Two Topics</option>
                        <option value="influencers">Key Influencers</option>
                    </select>
                </div>
                
                <button class="btn" onclick="getSocialInsights()">Get Social Insights</button>
            </div>

            <!-- Analyze Tab -->
            <div id="grok-analyze-tab" class="grok-tab" style="display:none;">
                <p style="color:#a1a1aa; margin-bottom:20px;">Deep analysis of text, data, or concepts.</p>
                
                <div class="form-group">
                    <label>Content to Analyze</label>
                    <textarea id="analyze-content" placeholder="Paste text, data, or describe what you want analyzed..." style="min-height:150px;"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Analysis Focus</label>
                    <select id="analyze-focus">
                        <option value="general">General Analysis</option>
                        <option value="business">Business Strategy</option>
                        <option value="technical">Technical Deep Dive</option>
                        <option value="competitive">Competitive Analysis</option>
                        <option value="audience">Target Audience Insights</option>
                        <option value="risks">Risk Assessment</option>
                    </select>
                </div>
                
                <button class="btn" onclick="analyzeContent()">Analyze with Grok</button>
            </div>

            <!-- Creative Writing Tab -->
            <div id="grok-creative-tab" class="grok-tab" style="display:none;">
                <p style="color:#a1a1aa; margin-bottom:20px;">Generate creative content - social posts, emails, ad copy, scripts.</p>
                
                <div class="form-group">
                    <label>Content Type</label>
                    <select id="creative-type">
                        <option value="social">Social Media Post</option>
                        <option value="email">Email Campaign</option>
                        <option value="ad">Advertisement Copy</option>
                        <option value="blog">Blog Post</option>
                        <option value="script">Event Script</option>
                        <option value="press">Press Release</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Topic/Brief</label>
                    <textarea id="creative-brief" placeholder="Describe what you want created..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Tone</label>
                    <select id="creative-tone">
                        <option value="professional">Professional</option>
                        <option value="luxury">Luxury/Premium</option>
                        <option value="casual">Casual/Friendly</option>
                        <option value="exciting">Exciting/Bold</option>
                        <option value="exclusive">Exclusive/Elite</option>
                        <option value="technical">Technical/Detailed</option>
                    </select>
                </div>
                
                <button class="btn" onclick="createContent()">Generate Content</button>
                
                <div style="margin-top:20px; padding:15px; background:rgba(59,130,246,0.1); border-radius:8px; border:1px solid rgba(59,130,246,0.3);">
                    <strong style="color:#d4d4d8;">‚ú® Quick Templates:</strong>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                        <button class="btn" style="padding:10px; font-size:13px;" onclick="loadTemplate('instagram')">üì∏ Instagram</button>
                        <button class="btn" style="padding:10px; font-size:13px;" onclick="loadTemplate('linkedin')">üíº LinkedIn</button>
                        <button class="btn" style="padding:10px; font-size:13px;" onclick="loadTemplate('twitter')">üê¶ Twitter</button>
                        <button class="btn" style="padding:10px; font-size:13px;" onclick="loadTemplate('email')">üìß Email</button>
                    </div>
                </div>
            </div>

            <!-- Code Generation Tab -->
            <div id="grok-code-tab" class="grok-tab" style="display:none;">
                <p style="color:#a1a1aa; margin-bottom:20px;">Generate, debug, or explain code in any language.</p>
                
                <div class="form-group">
                    <label>Programming Language</label>
                    <select id="code-language">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="typescript">TypeScript</option>
                        <option value="sql">SQL</option>
                        <option value="html">HTML/CSS</option>
                        <option value="any">Any Language</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Task</label>
                    <select id="code-task">
                        <option value="generate">Generate New Code</option>
                        <option value="debug">Debug/Fix Code</option>
                        <option value="explain">Explain Code</option>
                        <option value="optimize">Optimize Code</option>
                        <option value="convert">Convert Between Languages</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Description or Code</label>
                    <textarea id="code-input" placeholder="Describe what you want or paste code..." style="min-height:150px; font-family:monospace;"></textarea>
                </div>
                
                <button class="btn" onclick="processCode()">Process with Grok</button>
            </div>

            <!-- Loading and Results -->
            <div class="loading" id="grok-loading">
                <div class="spinner"></div>
                <p>Grok is thinking...</p>
            </div>
            
            <div id="grok-result"></div>
        </div>

        <!-- Image Generation Section -->
        <div class="card" id="image-section" style="display:none;">
            <h2>üñºÔ∏è Generate Image</h2>
            <div class="form-group">
                <label>Image Prompt</label>
                <textarea id="image-prompt" placeholder="Describe the image you want to generate..."></textarea>
            </div>
            <div class="form-group">
                <label>Width</label>
                <input type="number" id="image-width" value="1024" step="64">
            </div>
            <div class="form-group">
                <label>Height</label>
                <input type="number" id="image-height" value="768" step="64">
            </div>
            <button class="btn" onclick="generateImage()">Generate with Krea</button>
            <button class="btn btn-secondary" onclick="searchStock()" style="margin-left:10px;">Search Freepik</button>
            <div class="loading" id="image-loading">
                <div class="spinner"></div>
                <p>Generating image...</p>
            </div>
            <div id="image-result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:4000';

        // Check health on load
        window.onload = checkHealth;

        function showSection(section) {
            document.querySelectorAll('[id$="-section"]').forEach(el => el.style.display = 'none');
            document.getElementById(section + '-section').style.display = 'block';
        }

        async function checkHealth() {
            try {
                const res = await fetch(`${API_BASE}/health`);
                const data = await res.json();
                
                const indicator = document.getElementById('health-indicator');
                const resultDiv = document.getElementById('health-result');
                
                if (data.status === 'healthy') {
                    indicator.className = 'status-indicator status-healthy';
                    resultDiv.innerHTML = `<p class="success">‚úÖ System Healthy</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    indicator.className = 'status-indicator status-error';
                    resultDiv.innerHTML = `<p class="error">‚ùå System Error</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
                resultDiv.style.display = 'block';

                // Update services list
                const servicesList = document.getElementById('services-list');
                const services = [
                    { name: 'Perplexity', status: true },
                    { name: 'Claude (Anthropic)', status: data.canva?.configured || false },
                    { name: 'Grok (xAI)', status: true },
                    { name: 'Gamma', status: true },
                    { name: 'Canva', status: data.canva?.hasDesignTokens || false },
                    { name: 'Krea', status: true },
                    { name: 'Freepik', status: true }
                ];
                
                servicesList.innerHTML = services.map(s => `
                    <li class="service-item">
                        <span>${s.name}</span>
                        <span class="status-indicator ${s.status ? 'status-healthy' : 'status-error'}"></span>
                    </li>
                `).join('');
                
            } catch (error) {
                document.getElementById('health-indicator').className = 'status-indicator status-error';
                document.getElementById('health-result').innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
                document.getElementById('health-result').style.display = 'block';
            }
        }

        async function conductResearch() {
            const topic = document.getElementById('research-topic').value;
            const depth = document.getElementById('research-depth').value;
            
            if (!topic) {
                alert('Please enter a research topic');
                return;
            }

            const loading = document.getElementById('research-loading');
            const resultDiv = document.getElementById('research-result');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/research`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, depth })
                });
                
                const data = await res.json();
                loading.style.display = 'none';

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Research Complete</p>
                            <h3>Combined Insights:</h3>
                            <p style="white-space: pre-wrap; margin: 10px 0;">${data.data.combinedInsights}</p>
                            ${data.data.sources && data.data.sources.length > 0 ? `<p><strong>Sources:</strong> ${data.data.sources.length} found</p>` : ''}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå ${data.message || 'Research failed'}</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function generateProposal() {
            const clientName = document.getElementById('proposal-client').value;
            const eventType = document.getElementById('proposal-event').value;
            const detailsStr = document.getElementById('proposal-details').value;
            const numSlides = parseInt(document.getElementById('proposal-slides').value);

            if (!clientName || !eventType) {
                alert('Please enter client name and event type');
                return;
            }

            let eventDetails = {};
            if (detailsStr) {
                try {
                    eventDetails = JSON.parse(detailsStr);
                } catch (e) {
                    alert('Invalid JSON in event details');
                    return;
                }
            }

            const loading = document.getElementById('proposal-loading');
            const resultDiv = document.getElementById('proposal-result');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/proposals/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ clientName, eventType, eventDetails, numSlides })
                });
                
                const data = await res.json();
                loading.style.display = 'none';

                if (data.success) {
                    const presentation = data.data.presentation;
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Proposal Generated!</p>
                            <p><strong>Generation ID:</strong> ${presentation.generationId}</p>
                            <p><button class="btn" onclick="pollGammaStatus('${presentation.generationId}', 'proposal-result')">Check Status</button></p>
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå ${data.message || data.error || 'Generation failed'}</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function createPresentation() {
            const content = document.getElementById('gamma-content').value;
            const numCards = parseInt(document.getElementById('gamma-slides').value);

            if (!content) {
                alert('Please enter presentation content');
                return;
            }

            const loading = document.getElementById('gamma-loading');
            const resultDiv = document.getElementById('gamma-result');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/gamma/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        inputText: content, 
                        format: 'presentation', 
                        textMode: 'generate',
                        numCards,
                        textOptions: { amount: 'detailed' }
                    })
                });
                
                const data = await res.json();
                loading.style.display = 'none';

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Presentation Created!</p>
                            <p><strong>Generation ID:</strong> ${data.data.generationId}</p>
                            <p><button class="btn" onclick="pollGammaStatus('${data.data.generationId}', 'gamma-result')">Check Status</button></p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå ${data.message || 'Creation failed'}</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function pollGammaStatus(generationId, targetDiv) {
            const resultDiv = document.getElementById(targetDiv);
            resultDiv.innerHTML += '<p>Checking status...</p>';
            
            try {
                const res = await fetch(`${API_BASE}/gamma/status/${generationId}`);
                const data = await res.json();

                if (data.success) {
                    if (data.data.status === 'completed' && data.data.gammaUrl) {
                        resultDiv.innerHTML = `
                            <div class="result-box">
                                <p class="success">‚úÖ Presentation Ready!</p>
                                <p><a href="${data.data.gammaUrl}" target="_blank" class="link">Open Presentation ‚Üí</a></p>
                                <pre>${JSON.stringify(data.data, null, 2)}</pre>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML += `<p>Status: ${data.data.status}. <button class="btn" onclick="pollGammaStatus('${generationId}', '${targetDiv}')">Check Again</button></p>`;
                    }
                } else {
                    resultDiv.innerHTML += `<p class="error">‚ùå Error checking status</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Update temperature display
        document.getElementById('grok-temperature')?.addEventListener('input', function(e) {
            document.getElementById('temp-value').textContent = e.target.value;
        });

        // Tab switching for Grok
        function switchGrokTab(event, tab) {
            // Hide all tabs
            document.querySelectorAll('.grok-tab').forEach(t => t.style.display = 'none');
            
            // Show selected tab
            document.getElementById(`grok-${tab}-tab`).style.display = 'block';
            
            // Update active button
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function getSocialInsights() {
            const topic = document.getElementById('social-topic').value;
            const type = document.getElementById('social-type').value;

            if (!topic) {
                alert('Please enter a topic');
                return;
            }

            const prompts = {
                trending: `What's currently trending on X/Twitter about ${topic}? Give me the latest buzz, popular discussions, and key talking points.`,
                sentiment: `Analyze the sentiment on social media about ${topic}. What are people saying? Is it positive, negative, or mixed? Give specific examples.`,
                comparison: `Compare the social media presence and sentiment between ${topic}. Which one has more buzz? What are people saying about each?`,
                influencers: `Who are the key influencers and thought leaders talking about ${topic} on social media? What's their reach and impact?`
            };

            await sendGrokMessage(prompts[type]);
        }

        async function analyzeContent() {
            const content = document.getElementById('analyze-content').value;
            const focus = document.getElementById('analyze-focus').value;

            if (!content) {
                alert('Please enter content to analyze');
                return;
            }

            const prompts = {
                general: `Analyze this content and provide key insights:\n\n${content}`,
                business: `Analyze this from a business strategy perspective. What are the opportunities, challenges, and recommendations?\n\n${content}`,
                technical: `Provide a deep technical analysis of this:\n\n${content}`,
                competitive: `Analyze this from a competitive positioning perspective. What are the strengths, weaknesses, and market position?\n\n${content}`,
                audience: `Analyze the target audience implications of this content. Who is this for? What resonates?\n\n${content}`,
                risks: `Conduct a risk assessment of this content/situation. What are the potential risks and mitigation strategies?\n\n${content}`
            };

            await sendGrokMessage(prompts[focus]);
        }

        async function createContent() {
            const type = document.getElementById('creative-type').value;
            const brief = document.getElementById('creative-brief').value;
            const tone = document.getElementById('creative-tone').value;

            if (!brief) {
                alert('Please enter a brief');
                return;
            }

            const prompts = {
                social: `Write a ${tone} social media post about: ${brief}. Make it engaging and shareable.`,
                email: `Write a ${tone} email about: ${brief}. Include subject line.`,
                ad: `Write ${tone} advertisement copy for: ${brief}. Make it compelling and conversion-focused.`,
                blog: `Write a ${tone} blog post about: ${brief}. Include an attention-grabbing intro.`,
                script: `Write a ${tone} event script for: ${brief}. Include key talking points and flow.`,
                press: `Write a ${tone} press release about: ${brief}. Follow standard PR format.`
            };

            await sendGrokMessage(prompts[type]);
        }

        function loadTemplate(platform) {
            const templates = {
                instagram: {
                    type: 'social',
                    tone: 'exciting',
                    brief: 'ICAUR luxury SUV test drive event at Dubai Marina. 3 flagship vehicles, VIP experience, exclusive networking.'
                },
                linkedin: {
                    type: 'social',
                    tone: 'professional',
                    brief: 'Professional networking event for automotive industry executives. Showcase latest luxury vehicles and discuss market trends.'
                },
                twitter: {
                    type: 'social',
                    tone: 'exciting',
                    brief: 'Launch announcement for exclusive automotive experience. Create thread format (5-7 tweets).'
                },
                email: {
                    type: 'email',
                    tone: 'luxury',
                    brief: 'VIP invitation to exclusive test drive event. Limited spots, high-end experience, Dubai Marina location.'
                }
            };

            const template = templates[platform];
            document.getElementById('creative-type').value = template.type;
            document.getElementById('creative-tone').value = template.tone;
            document.getElementById('creative-brief').value = template.brief;
            switchGrokTab({ target: document.querySelectorAll('.tab-btn')[3] }, 'creative');
        }

        async function processCode() {
            const language = document.getElementById('code-language').value;
            const task = document.getElementById('code-task').value;
            const input = document.getElementById('code-input').value;

            if (!input) {
                alert('Please enter a description or code');
                return;
            }

            const prompts = {
                generate: `Write ${language} code for: ${input}. Include comments and best practices.`,
                debug: `Debug and fix this ${language} code:\n\n${input}\n\nExplain what was wrong and how you fixed it.`,
                explain: `Explain this ${language} code in detail:\n\n${input}`,
                optimize: `Optimize this ${language} code for better performance:\n\n${input}\n\nExplain the improvements.`,
                convert: `Convert this code to ${language}:\n\n${input}`
            };

            await sendGrokMessage(prompts[task]);
        }

        async function sendGrokMessage(message) {
            const loading = document.getElementById('grok-loading');
            const resultDiv = document.getElementById('grok-result');
            const model = document.getElementById('grok-model')?.value || 'grok-4-latest';
            const temperature = parseFloat(document.getElementById('grok-temperature')?.value || 0.7);
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/chat/grok`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        messages: [{ role: 'user', content: message }],
                        model: model,
                        temperature: temperature,
                        max_tokens: 4096
                    })
                });
                
                const data = await res.json();
                loading.style.display = 'none';

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Grok's Response:</p>
                            <div style="background:rgba(39,39,42,0.6); padding:20px; border-radius:12px; margin-top:15px; line-height:1.8; color:#e4e4e7;">
                                ${data.data.content.replace(/\n/g, '<br>').replace(/```(.*?)```/gs, '<pre>$1</pre>')}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå ${data.message || 'Request failed'}</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function chatWithGrok() {
            const message = document.getElementById('grok-message').value;

            if (!message) {
                alert('Please enter a message');
                return;
            }

            await sendGrokMessage(message);
        }

        async function generateImage() {
            const prompt = document.getElementById('image-prompt').value;
            const width = parseInt(document.getElementById('image-width').value);
            const height = parseInt(document.getElementById('image-height').value);

            if (!prompt) {
                alert('Please enter an image prompt');
                return;
            }

            const loading = document.getElementById('image-loading');
            const resultDiv = document.getElementById('image-result');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/image/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, width, height })
                });
                
                const data = await res.json();

                if (data.success) {
                    const jobId = data.data.job_id;
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Image Generation Started!</p>
                            <p><strong>Job ID:</strong> ${jobId}</p>
                            <p>Checking status...</p>
                        </div>
                    `;
                    
                    // Poll for result
                    setTimeout(() => pollImageStatus(jobId), 3000);
                } else {
                    loading.style.display = 'none';
                    resultDiv.innerHTML = `<p class="error">‚ùå ${data.message || 'Generation failed'}</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function pollImageStatus(jobId, attempt = 0) {
            if (attempt > 20) {
                document.getElementById('image-result').innerHTML += '<p class="error">Timeout waiting for image</p>';
                document.getElementById('image-loading').style.display = 'none';
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/image/job/${jobId}`);
                const data = await res.json();

                if (data.success && data.data.status === 'completed') {
                    document.getElementById('image-loading').style.display = 'none';
                    const imageUrl = data.data.result?.urls?.[0];
                    if (imageUrl) {
                        document.getElementById('image-result').innerHTML = `
                            <div class="result-box">
                                <p class="success">‚úÖ Image Ready!</p>
                                <img src="${imageUrl}" style="max-width:100%; border-radius:8px; margin-top:10px;" />
                                <p style="margin-top:10px;"><a href="${imageUrl}" target="_blank" class="link">Open Full Size ‚Üí</a></p>
                            </div>
                        `;
                    }
                } else if (data.data.status === 'failed') {
                    document.getElementById('image-loading').style.display = 'none';
                    document.getElementById('image-result').innerHTML = '<p class="error">‚ùå Image generation failed</p>';
                } else {
                    // Still processing, poll again
                    setTimeout(() => pollImageStatus(jobId, attempt + 1), 2000);
                }
            } catch (error) {
                document.getElementById('image-loading').style.display = 'none';
                document.getElementById('image-result').innerHTML += `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function searchStock() {
            const term = document.getElementById('image-prompt').value;

            if (!term) {
                alert('Please enter a search term');
                return;
            }

            const loading = document.getElementById('image-loading');
            const resultDiv = document.getElementById('image-result');
            
            loading.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/stock/search?term=${encodeURIComponent(term)}&limit=6`);
                const data = await res.json();
                loading.style.display = 'none';

                if (data.success && data.data.data) {
                    const imagesHtml = data.data.data.map(item => `
                        <div style="margin-bottom:15px;">
                            <img src="${item.image?.source?.url || ''}" style="width:100%; border-radius:8px;" onerror="this.style.display='none'" />
                            <p style="margin-top:5px; font-size:12px;">${item.title || 'Untitled'}</p>
                        </div>
                    `).join('');
                    
                    resultDiv.innerHTML = `
                        <div class="result-box">
                            <p class="success">‚úÖ Found ${data.data.data.length} images from Freepik</p>
                            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin-top:15px;">
                                ${imagesHtml}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå No results found</p>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
